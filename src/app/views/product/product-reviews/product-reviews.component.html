<div class="product-reviews">
  <div class="reviews-header mb-4">
    <h3>Đánh giá sản phẩm</h3>
    <div class="average-rating">
      <div class="rating-stars">
        <svg cIcon *ngFor="let star of [1,2,3,4,5]"
           name="cil-star"
           [class.text-warning]="star <= averageRating"
           [class.text-muted]="star > averageRating">
        </svg>
      </div>
      <span class="rating-value">{{averageRating | number:'1.1-1'}}/5</span>
      <span class="review-count">({{reviews.length}} đánh giá)</span>
    </div>
  </div>

  <!-- Form đánh giá -->
  <div class="review-form mb-4" *ngIf="isLoggedIn">
    <h4>{{userReview ? 'Cập nhật đánh giá của bạn' : 'Viết đánh giá của bạn'}}</h4>
    <div class="rating-input mb-3">
      <div class="stars">
        <svg cIcon *ngFor="let star of [1,2,3,4,5]"
           name="cil-star"
           [class.text-warning]="star <= (userReview?.rating || 0)"
           [class.text-muted]="star > (userReview?.rating || 0)"
           (click)="submitReview(star, userReview?.comment || '')">
        </svg>
      </div>
    </div>
    <div class="form-group">
      <textarea class="form-control"
                rows="3"
                placeholder="Viết đánh giá của bạn về sản phẩm này..."
                [(ngModel)]="userReview?.comment"
                (ngModelChange)="submitReview(userReview?.rating || 0, $event)">
      </textarea>
    </div>
    <button class="btn btn-danger" *ngIf="userReview" (click)="deleteReview()">
      <svg cIcon name="cil-trash"></svg> Xóa đánh giá
    </button>
  </div>

  <!-- Danh sách đánh giá -->
  <div class="reviews-list">
    <div class="review-item mb-4" *ngFor="let review of reviews">
      <div class="review-header d-flex justify-content-between align-items-center">
        <div class="user-info">
          <img [src]="review.user?.avatar || 'assets/img/default-avatar.png'"
               class="avatar"
               alt="User avatar">
          <span class="username">{{review.user?.username}}</span>
        </div>
        <div class="review-date">
          {{review.createdAt | date:'dd/MM/yyyy HH:mm'}}
        </div>
      </div>
      <div class="review-rating mb-2">
        <svg cIcon *ngFor="let star of [1,2,3,4,5]"
           name="cil-star"
           [class.text-warning]="star <= review.rating"
           [class.text-muted]="star > review.rating">
        </svg>
      </div>
      <div class="review-content">
        {{review.comment}}
      </div>
    </div>

    <div class="no-reviews text-center py-4" *ngIf="reviews.length === 0">
      <svg cIcon name="cil-comment-slash" class="fa-3x text-muted mb-3"></svg>
      <p>Chưa có đánh giá nào cho sản phẩm này</p>
    </div>
  </div>
</div>
